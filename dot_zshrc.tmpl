# <<< Pre Block

# Kiro CLI pre block. Keep at the top of this file.
{{- if eq .chezmoi.os "darwin" }}
if [[ -f "${HOME}/Library/Application Support/kiro-cli/shell/zshrc.pre.zsh" ]]; then
  builtin source "${HOME}/Library/Application Support/kiro-cli/shell/zshrc.pre.zsh"
fi
{{- else if eq .chezmoi.os "linux" }}
if [[ -f "${HOME}/.local/share/kiro-cli/shell/zshrc.pre.zsh" ]]; then
  builtin source "${HOME}/.local/share/kiro-cli/shell/zshrc.pre.zsh"
fi
{{- end }}

# >>>
# <<< History Configuration

HISTSIZE=10000
SAVEHIST=10000
setopt HIST_IGNORE_DUPS
setopt HIST_IGNORE_SPACE

# >>>
# <<< Shell Options

setopt AUTO_CD               # Change directory by typing directory name
setopt AUTO_PUSHD            # Push directory to stack on cd
setopt PUSHD_IGNORE_DUPS     # Ignore duplicate directories in stack
setopt CORRECT               # Correct command spelling

# >>>
# <<< Prompt Configuration

PS1='%n@%m:%1~%# '

# >>>
# <<< Plugins

{{- if eq .chezmoi.os "darwin" }}
# Add Homebrew's site-functions to fpath
if [[ -d "/opt/homebrew/share/zsh/site-functions" ]]; then
  fpath=(/opt/homebrew/share/zsh/site-functions $fpath)
fi
{{- end }}

# Initialize completion system
autoload -Uz compinit
compinit

{{- if eq .chezmoi.hostname "7cf34ded5d65" }}
# Brazil Completion
if [[ -f "${HOME}/.brazil_completion/zsh_completion" ]]; then
  builtin source "${HOME}/.brazil_completion/zsh_completion"
fi
{{- end }}

# 1Password CLI Completion
if [ -x "$(command -v op)" ]; then
  eval "$(op completion zsh)"; compdef _op op
fi

{{- if eq .chezmoi.os "darwin" }}
# direnv
if [ -x "$(command -v direnv)" ]; then
  eval "$(direnv hook zsh)"
fi
{{- end }}

# Zsh Vi Mode
{{- if eq .chezmoi.os "darwin" }}
if [[ -f "$(brew --prefix)/opt/zsh-vi-mode/share/zsh-vi-mode/zsh-vi-mode.plugin.zsh" ]]; then
  builtin source "$(brew --prefix)/opt/zsh-vi-mode/share/zsh-vi-mode/zsh-vi-mode.plugin.zsh"
fi
{{- else if eq .chezmoi.os "linux" }}
# zinit
if [[ -f "/usr/local/share/zinit/zinit.git/zinit.zsh" ]]; then
  source "/usr/local/share/zinit/zinit.git/zinit.zsh"
  autoload -Uz _zinit
  (( ${+_comps} )) && _comps[zinit]=_zinit

  # zsh-vi-mode
  zinit ice depth=1
  zinit light jeffreytse/zsh-vi-mode
fi
{{- end }}

# >>>
# <<< Key Bindings

bindkey -M vicmd "H" beginning-of-line
bindkey -M vicmd "L" end-of-line

# >>>
# <<< Aliases

# bat aliases
{{- if eq .chezmoi.os "darwin" }}
if command -v bat &> /dev/null; then
  alias less="bat"
fi
{{- else if eq .chezmoi.os "linux" }}
if command -v batcat &> /dev/null; then
  alias bat="batcat"
  alias less="batcat"
elif command -v bat &> /dev/null; then
  alias less="bat"
fi
{{- end }}

# ls aliases
{{- if eq .chezmoi.os "darwin" }}
alias ls="ls -FG"
alias ll="ls -lFG"
alias la="ls -aFG"
alias lal="ls -alFG"
{{- else if eq .chezmoi.os "linux" }}
alias ls="ls -F --color=auto"
alias ll="ls -lF --color=auto"
alias la="ls -aF --color=auto"
alias lal="ls -alF --color=auto"
{{- end }}

# Safe operations
alias cp="cp -i"
alias ln="ln -i"
alias mv="mv -i"
alias rm="rm -i"

# Navigation
alias ..="cd .."
alias ...="cd ../.."
alias d="dirs -v"

# Disk usage
alias df="df -h"
alias du="du -h"

# Grep with color
alias grep="grep --color=auto"

# History
alias h="history"
alias hg="history | grep"

# Editor
alias vi="vim"
alias view="vim -R"
alias zprofile="${EDITOR} ~/.zprofile"
alias zshrc="${EDITOR} ~/.zshrc"

# 1Password CLI
{{- else if eq .chezmoi.os "linux" }}
alias opsignin="eval $(op signin)"
{{- end }}

# Kiro CLI
alias k="kiro-cli chat"
alias kr="kiro-cli chat --resume"
{{- if eq .chezmoi.hostname "7cf34ded5d65" }}
alias ksa="kiro-cli chat --agent sa"
alias ksar="kiro-cli chat --agent sa --resume"
{{- end }}

# >>>
# <<< Safe-chain Initialization

# Safe-chain Zsh initialization script
if [[ -f "${HOME}/.safe-chain/scripts/init-posix.sh" ]]; then
  builtin source "${HOME}/.safe-chain/scripts/init-posix.sh"
fi

# >>>
# <<< Post Block

# Kiro CLI post block. Keep at the bottom of this file.
{{- if eq .chezmoi.os "darwin" }}
if [[ -f "${HOME}/Library/Application Support/kiro-cli/shell/zshrc.post.zsh" ]]; then
  builtin source "${HOME}/Library/Application Support/kiro-cli/shell/zshrc.post.zsh"
fi
{{- else if eq .chezmoi.os "linux" }}
if [[ -f "${HOME}/.local/share/kiro-cli/shell/zshrc.post.zsh" ]]; then
  builtin source "${HOME}/.local/share/kiro-cli/shell/zshrc.post.zsh"
fi
{{- end }}

# >>>
